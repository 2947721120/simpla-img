<link rel="import" href="../polymer/polymer.html"> <dom-module id="simpla-img"> <script>!function(){"use strict";var e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAYAAACddGYaAAAADklEQVQYV2NkQAKMyBwAAEEAA8aUUQIAAAAASUVORK5CYII=",t={width:180,height:130},i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},r=function(){function e(e,t){var i=[],r=!0,a=!1,n=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(i.push(o.value),!t||i.length!==t);r=!0);}catch(e){a=!0,n=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw n}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(e){if(e.message.toLowerCase().indexOf("invalid path")===-1)throw e;console.warn(e.message)},n={properties:{path:{type:String,observer:"_initPath"},_simplaObservers:{type:Object,value:function(){return{}}}},observers:["_setData(src, alt, path)"],created:function(){window.Simpla||console.error("Cannot find Simpla global")},attached:function(){this.editable=this.editable||Simpla.getState("editable"),this._observeEditable()},detached:function(){var e=this;Object.keys(this._simplaObservers).forEach(function(t){e._simplaObservers[t].unobserve()}),this._simplaObservers=[]},_initPath:function(e){var t=this;Simpla.get(e).then(function(e){return t._setPropsFromSimpla(e)}).catch(a),this._observeBuffer(e)},_setData:function(t,i,r){var n=void 0;if(!this.__comingFromSimpla&&t!==e)return n={src:this.src,alt:this.alt},Simpla.set(r,{type:"Image",data:n}).catch(a)},_observeBuffer:function(e){var t=this,i=this._simplaObservers;if(e){i.buffer&&i.buffer.unobserve();try{i.buffer=Simpla.observe(e,function(e){return t._setPropsFromSimpla(e)})}catch(e){a(e)}}},_setPropsFromSimpla:function(e){e&&e.data&&(this.__comingFromSimpla=!0,i(this,e.data),this.__comingFromSimpla=!1)},_observeEditable:function(){var e=this,t=this._simplaObservers;t.editable&&t.editable.unobserve(),t.editable=Simpla.observeState("editable",function(t){return e.editable=t})}},o=document.createElement("simpla-img-editor"),s=!1,l={observers:["_updateEditorImage(active)","_ensureEditorReady(editable)"],_updateEditorImage:function(e){o.image=e?this:null},_ensureEditorReady:function(e){if(e&&!s){var t=this.resolveUrl("simpla-img-editor.html"),i=document.createElement("link");i.rel="import",i.setAttribute("async",!0),i.href=t,document.head.appendChild(i),document.body.appendChild(o),s=!0}}},c={editable:{cursor:"pointer"},active:{visibility:"hidden",transition:"visibility",transitionDelay:"50ms"},placeholder:{minHeight:t.height+"px",minWidth:t.width+"px",backgroundSize:"cover",backgroundPosition:"center center",opacity:"0.75"}},u={is:"simpla-img",extends:"img",properties:{src:{type:String,reflectToAttribute:!0,value:function(){return e},notify:!0},alt:{type:String,reflectToAttribute:!0,value:"",notify:!0},placeholder:{type:String,value:""},editable:{type:Boolean,reflectToAttribute:!0,notify:!0,value:!1},active:{type:Boolean,notify:!0,value:!1}},observers:["_styleEditable(editable)","_styleEditing(active)","_showPlaceholder(placeholder, editable, src)"],listeners:{tap:"_tapHandler"},behaviors:[n,l],_styleEditable:function(e){this._toggleStyles(c.editable,e)},_styleEditing:function(e){this._toggleStyles(c.active,e)},_showPlaceholder:function(t,r,a){var n=r&&a===e,o=void 0;t||(t="url("+this.resolveUrl("placeholder.gif")+")"),o=i({background:t},c.placeholder),this._toggleStyles(o,n)},_toggleStyles:function(e,t){var i=this,a=this.__styleCache=this.__styleCache||{};(function(e){return Object.keys(e).map(function(t){return[t,e[t]]})})(e).forEach(function(e){var n=r(e,2),o=n[0],s=n[1],l=a[o],c=i.style[o];t?a[o]=c:(a[o]="",s=l||""),i.style[o]=s})},_tapHandler:function(){this.editable&&(this.active=!0)}};Polymer(u)}()</script> </dom-module> 