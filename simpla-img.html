<link rel="import" href="../polymer/polymer.html"> <dom-module id="simpla-img"> <script>!function(){"use strict";function e(e,t){v[t.uid]={src:e.src,zoom:e.zoom}}function t(e,t){v[t.uid]&&u(e,v[t.uid])}function i(e,t){if(!b){var i=t.resolveUrl(h),n=document.createElement("link");n.rel="import",n.setAttribute("async",!0),n.href=i,document.head.appendChild(n),document.body.appendChild(e),b=!0}}function n(e,t){var i=t.getBoundingClientRect(),n=i.top,r=i.left,o=i.width,a=i.height;t.src;u(e.style,{top:n+"px",left:r+"px"}),u(e,{width:o,height:a})}function r(e,t){var i=t.src,n=t.alt;u(e,{src:i,alt:n})}function o(e){e.src="",e.alt="",e.zoom=1}function a(e,t){var i;i={},c(i,"output-changed",function(e){t.src=e.detail.value}),c(i,"alt-changed",function(e){t.alt=e.detail.value}),c(i,"active-changed",function(e){e.detail.value||(t.editing=!1)}),c(i,"src-changed",function(i){t.src=i.detail.value,n(e,t)}),c(i,"keyup",function(e){var i=13===e.keyCode&&e.metaKey,n=27===e.keyCode;(i||n)&&(t.editing=!1)}),p=i,Object.keys(p).forEach(function(t){e.addEventListener(t,p[t])}),g=function(i){i.path.indexOf(t)===-1&&i.path.indexOf(e)===-1&&(e.active=!1)},window.addEventListener("tap",g),window.addEventListener("mouseup",g),window.addEventListener("touchend",g)}function s(e,t){Object.keys(p).forEach(function(t){e.removeEventListener(t,p[t])}),window.removeEventListener("tap",g),window.removeEventListener("mouseup",g),window.removeEventListener("touchend",g)}var l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},d=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),c=function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},f={properties:{uid:{type:String,observer:"_initUid"},_simplaObservers:{type:Object,value:function(){return{}}}},observers:["_setData(src, alt, uid)"],created:function(){window.Simpla||console.error("Cannot find Simpla global")},attached:function(){this._observeEditable()},detached:function(){var e=this;Object.keys(this._simplaObservers).forEach(function(t){e._simplaObservers[t].unobserve()}),this._simplaObservers=[]},_initUid:function(e){var t=this;Simpla.get(e).then(function(e){e&&e.data&&u(t.data,e.data)}),this._observeBuffer(e)},_setData:function(e,t,i){return Simpla.set(i,{type:"Image",data:{src:e,alt:t}})},_observeBuffer:function(e){var t=this,i=this._simplaObservers,n=function(e){e&&e.data&&u(t,e.data)};e&&(i.buffer&&i.buffer.unobserve(),i.buffer=Simpla.observe(e,n))},_observeEditable:function(){var e=this,t=this._simplaObservers;this.editable=Simpla.getState("editable"),t.editable&&t.editable.unobserve(),t.editable=Simpla.observeState("editable",function(t){return e.editable=t})}},v={},h="simpla-img-editor.html",b=!1,p=void 0,g=void 0,y=document.createElement("simpla-img-editor"),m=void 0,_={observers:["_toggleEditorBindings(editing)","_stopEditingOnResizeOrScroll(editing)","_ensureEditorReady(editable)"],listeners:{tap:"_tapHandler"},_tapHandler:function(){this.editable&&(this.editing=!0)},_toggleEditorBindings:function(i){if(i)m&&(m.editing=!1),a(y,this),n(y,this),r(y,this),t(y,this),m=this,y.active=!0;else{if(!m)return;y.active=!1,s(y,m),e(y,m),o(y),m=null}},_ensureEditorReady:function(e){e&&i(y,this)},_stopEditingOnResizeOrScroll:function(e){var t=this,i=this.__exitHandler=this.__exitHandler||function(){return t.editing=!1};e?(window.addEventListener("resize",i),window.addEventListener("scroll",i)):(window.removeEventListener("resize",i),window.removeEventListener("scroll",i))}},w={editable:{cursor:"pointer"},editing:{visibility:"hidden",transition:"visibility",transitionDelay:"50ms"},placeholder:{background:"#b2bcc8",width:"100px",height:"100px"}},E=function(){function e(){l(this,e)}return d(e,[{key:"beforeRegister",value:function(){this.is="simpla-img",this.extends="img",this.properties={src:{type:String,reflectToAttribute:!0,value:"",notify:!0},alt:{type:String,reflectToAttribute:!0,value:"",notify:!0},editable:{type:Boolean,notify:!0,value:!1},editing:{type:Boolean,notify:!0,value:!1}},this.observers=["_styleEditable(editable)","_styleEditing(editing)","_showPlaceholder(editable, editing, src)"]}},{key:"_styleEditable",value:function(e){this._toggleStyles(w.editable,e)}},{key:"_styleEditing",value:function(e){this._toggleStyles(w.editing,e)}},{key:"_showPlaceholder",value:function(e,t,i){var n=e&&!t&&!i;this._toggleStyles(w.placeholder,n)}},{key:"_toggleStyles",value:function(e,t){var i=this;Object.keys(e).forEach(function(n){i.style[n]=t?e[n]:""})}},{key:"_stopEditingOnResizeOrScroll",value:function(e){var t=this,i=this.__exitHandler=this.__exitHandler||function(){return t.editing=!1};e?(window.addEventListener("resize",i),window.addEventListener("scroll",i)):(window.removeEventListener("resize",i),window.removeEventListener("scroll",i))}},{key:"_stopEditingOnHotkeys",value:function(e){var t=13===e.keyCode&&e.metaKey,i=27===e.keyCode;(t||i)&&(this.editing=!1)}},{key:"behaviors",get:function(){return[f,_]}}]),e}();Polymer(E)}()</script> </dom-module> 