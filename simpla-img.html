<link rel="import" href="../polymer/polymer.html"> <dom-module id="simpla-img"> <script>!function(){"use strict";var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},t=function(){function e(e,t){var i=[],r=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(e){n=!0,a=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw a}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i={properties:{uid:{type:String,observer:"_initUid"},_simplaObservers:{type:Object,value:function(){return{}}}},observers:["_setData(src, alt, uid)"],created:function(){window.Simpla||console.error("Cannot find Simpla global")},attached:function(){this.editable=this.editable||Simpla.getState("editable"),this._observeEditable()},detached:function(){var e=this;Object.keys(this._simplaObservers).forEach(function(t){e._simplaObservers[t].unobserve()}),this._simplaObservers=[]},_initUid:function(e){var t=this;Simpla.get(e).then(function(e){return t._setPropsFromSimpla(e)}),this._observeBuffer(e)},_setData:function(e,t,i){return Simpla.set(i,{type:"Image",data:{src:e,alt:t}})},_observeBuffer:function(e){var t=this,i=this._simplaObservers;e&&(i.buffer&&i.buffer.unobserve(),i.buffer=Simpla.observe(e,function(e){return t._setPropsFromSimpla(e)}))},_setPropsFromSimpla:function(t){t&&t.data&&e(this,t.data)},_observeEditable:function(){var e=this,t=this._simplaObservers;t.editable&&t.editable.unobserve(),t.editable=Simpla.observeState("editable",function(t){return e.editable=t})}},r="simpla-img-editor.html",n=document.createElement("simpla-img-editor"),a=!1,s={observers:["_updateEditorImage(editing)","_ensureEditorReady(editable)"],_updateEditorImage:function(e){n.image=e?this:null},_ensureEditorReady:function(e){if(e&&!a){var t=this.resolveUrl(r),i=document.createElement("link");i.rel="import",i.setAttribute("async",!0),i.href=t,document.head.appendChild(i),document.body.appendChild(n),a=!0}}},o={editable:{cursor:"pointer"},editing:{visibility:"hidden",transition:"visibility",transitionDelay:"50ms"},placeholder:{minHeight:"130px",minWidth:"180px",backgroundColor:"#b2bcc8"}},l={is:"simpla-img",extends:"img",properties:{src:{type:String,reflectToAttribute:!0,value:"",notify:!0},alt:{type:String,reflectToAttribute:!0,value:"",notify:!0},editable:{type:Boolean,notify:!0,value:!1},editing:{type:Boolean,notify:!0,value:!1}},observers:["_styleEditable(editable)","_styleEditing(editing)","_showPlaceholder(editable, editing, src)"],listeners:{tap:"_tapHandler"},behaviors:[i,s],_styleEditable:function(e){this._toggleStyles(o.editable,e)},_styleEditing:function(e){this._toggleStyles(o.editing,e)},_showPlaceholder:function(e,t,i){var r=e&&!t&&!i;this._toggleStyles(o.placeholder,r)},_toggleStyles:function(e,i){var r=this,n=this.__styleCache=this.__styleCache||{},a=function(e){return Object.keys(e).map(function(t){return[t,e[t]]})};a(e).forEach(function(e){var a=t(e,2),s=a[0],o=a[1],l=n[s],d=r.style[s];i?n[s]=d:(n[s]="",o=l||""),r.style[s]=o})},_tapHandler:function(){this.editable&&(this.editing=!0)}};Polymer(l)}()</script> </dom-module> 