<html><head><meta charset="UTF-8"><link rel="import" href="../iron-icon/iron-icon.html"><link rel="import" href="../sm-utility-share/sm-utility-share.html"><link rel="import" href="../sm-utility-connect/sm-utility-connect.html"><link rel="import" href="../default-content/default-content.html"><link rel="import" href="../sm-utility-placeholder/sm-utility-placeholder.html"><link rel="import" href="../sm-ui-button/sm-ui-button.html"><link rel="import" href="../simpla-core/simpla-core.html"><link rel="import" href="../polymer/polymer.html"></head><body><div hidden="" by-vulcanize=""><dom-module id="sm-img-canvas" assetpath="../sm-img-canvas/"> <template> <style include="sm-css"></style><style>:host{position:relative;display:inline-block;overflow:hidden;width:inherit;height:inherit;vertical-align:bottom}:host([editable]){background:-webkit-linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),-webkit-linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),rgba(255,255,255,.02);background:linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),rgba(255,255,255,.02);background-position:0 0,15px 15px;background-size:30px 30px}:host([editable]:hover)::before{content:'';position:absolute;top:0;right:0;bottom:0;left:0;background:var(--light-white);cursor:pointer;z-index:1}:host([active]){cursor:move}:host([active])::before{display:none}.img{vertical-align:bottom;-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;width:inherit;height:inherit}</style><img id="source" class="img" src$="[[src]]" width$="[[width]]" height$="[[height]]" on-track="_dragImage" on-down="_stopEvent" on-load="_imageLoaded"> </template> <script>!function(){"use strict";function t(t,e){return t<e.min?e.min:t>e.max?e.max:t}function e(t){var e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],i=["webkit","moz","o","ms"];return e&&(i=i.map(function(t){return"-"+t+"-"})),i.map(function(e){return""+e+t})}var i={};i.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i.createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var s=1,n=0,a=0,r="pan-finished",h=function(){function h(){i.classCallCheck(this,h)}return i.createClass(h,[{key:"beforeRegister",value:function(){this.is="sm-img-canvas",this.properties={width:Number,height:Number,src:String,scale:Number,translateX:Number,translateY:Number}}},{key:"_paint",value:function(){var t=this;this._tick&&(cancelAnimationFrame(this._tick),this._tick=null),this._tick=requestAnimationFrame(function(){var i=t.scale,s=t.translateX,n=t.translateY,a="scale("+i+") translateX("+s+"px) translateY("+n+"px)";e("Transform").concat("transform").forEach(function(e){t.$.source.style[e]=a})})}},{key:"_resetDimensions",value:function(){this._width=this.offsetWidth,this._height=this.offsetHeight,this._imgWidth=this.$.source.offsetWidth,this._imgHeight=this.$.source.offsetHeight}},{key:"_dragImage",value:function(t){var e=t.detail,i=e.dx,s=e.dy,n=e.ddx,a=e.ddy,h=e.state;"start"===h&&this._resetDimensions(),this.translateX+=("start"===h?i:n)/this.scale,this.translateY+=("start"===h?s:a)/this.scale,"end"===h&&this.fire(r)}},{key:"_stopEvent",value:function(t){t.preventDefault()}},{key:"_imageLoaded",value:function(){this._resetDimensions()}},{key:"behaviors",get:function(){return[simpla.behaviors.editable({reflectToAttribute:!0,notify:!1}),simpla.behaviors.active({reflectToAttribute:!0})]}},{key:"scale",get:function(){return this._scale||s},set:function(t){if(this.editable){var e=this.minScale;e>t?this._scale=parseFloat(e):this._scale=parseFloat(t),this.translateX+=0,this.translateY+=0,this._paint()}}},{key:"translateX",get:function(){return this._translateX||n},set:function(e){this.editable&&(this._translateX=t(e,this._bounds.x),this._paint())}},{key:"translateY",get:function(){return this._translateY||a},set:function(e){this.editable&&(this._translateY=t(e,this._bounds.y),this._paint())}},{key:"minScale",get:function(){var t=this.height/this.$.source.height,e=this.width/this.$.source.width;return isNaN(t)||isNaN(e)?1:e>t?t:e}},{key:"_bounds",get:function(){return this._imgWidth&&this._width&&this._imgHeight&&this._height?{x:{min:-(this._imgWidth*this.scale-this._width)/this.scale,max:0},y:{min:-(this._imgHeight*this.scale-this._height)/this.scale,max:0}}:{x:{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY},y:{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY}}}}]),h}();Polymer(h)}();</script></dom-module><dom-module id="sm-img-controls" assetpath="../sm-img-controls/"> <template> <style include="sm-css"></style><style>:host{overflow:visible;@apply(--typography)}.toolbox{position:absolute;display:none;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;background:var(--med-white);top:-5px;padding-top:5px;-webkit-transform:translateY(-100%);-ms-transform:translateY(-100%);transform:translateY(-100%);opacity:.5}.toolbox[visible]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}:host([position=right]) .toolbox{right:0;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;border-radius:0 0 0 var(--border-radius)}:host([position=left]) .toolbox{left:0;-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-webkit-flex-direction:row-reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse;border-radius:0 0 var(--border-radius)0}.toolbox__tool{color:var(--med-black);width:var(--tool-size);-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0}.toolbox__tool[active]{color:var(--blue)}.toolbox__tool:hover{color:var(--blue)}.toolbox__file{display:none}.toolbox__title{width:0;color:var(--text-color);-webkit-transition:width 140ms cubic-bezier(.215,.61,.355,1);transition:width 140ms cubic-bezier(.215,.61,.355,1)}.toolbox__title::-webkit-input-placeholder{opacity:0;color:var(--med-black);-webkit-transition:opacity 10ms;transition:opacity 10ms}.toolbox__title::-moz-placeholder{opacity:0;color:var(--med-black);transition:opacity 10ms}.toolbox__title:-ms-input-placeholder{opacity:0;color:var(--med-black);transition:opacity 10ms}.toolbox__title::placeholder{opacity:0;color:var(--med-black);-webkit-transition:opacity 10ms;transition:opacity 10ms}.toolbox__title--expanded::-webkit-input-placeholder{opacity:1;color:var(--med-black);-webkit-transition:opacity 80ms;transition:opacity 80ms}.toolbox__title--expanded::-moz-placeholder{opacity:1;color:var(--med-black);transition:opacity 80ms}.toolbox__title--expanded:-ms-input-placeholder{opacity:1;color:var(--med-black);transition:opacity 80ms}.toolbox__title--expanded::placeholder{opacity:1;color:var(--med-black);-webkit-transition:opacity 80ms;transition:opacity 80ms}.toolbox__title--expanded{width:220px}:host([position=right]) .toolbox__title--expanded{padding-left:14px}:host([position=left]) .toolbox__title--expanded{padding-right:14px}.zoom{position:absolute;display:none;left:5%;right:5%;border-top-left-radius:var(--border-radius);border-top-right-radius:var(--border-radius);background:var(--med-white);cursor:default;bottom:-5px;padding-bottom:5px;-webkit-transform:translateY(100%);-ms-transform:translateY(100%);transform:translateY(100%);opacity:.5}.zoom[visible]{display:block}.zoom__slider{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;height:var(--tool-size);width:90%;margin:0 auto;overflow:hidden}.zoom__slider__input{width:100%}.zoom__slider__input::-webkit-slider-runnable-track{-webkit-appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;background:var(--med-black);width:100%;height:4px;box-shadow:0;cursor:pointer;border-radius:999px;z-index:1}.zoom__slider__input::-moz-range-track{-moz-appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;background:var(--med-black);width:100%;height:4px;box-shadow:0;cursor:pointer;border-radius:999px;z-index:1}.zoom__slider__input::-ms-track{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;background:var(--med-black);width:100%;height:4px;box-shadow:0;cursor:pointer;border-radius:999px;z-index:1}input[type=range]{-webkit-appearance:none}input[type=range]::-moz-focus-outer{border:0}.zoom__slider__input::-ms-track{color:transparent;border:8px solid transparent;background:0 0}.zoom__slider__input::-ms-fill-upper{background:var(--med-black);border-radius:999px}.zoom__slider__input::-ms-tooltip{display:none}.zoom__slider__input::-webkit-slider-runnable-track:focus{-webkit-appearance:none;outline:0}.zoom__slider__input::-moz-range-track:focus{-moz-appearance:none;outline:0}.zoom__slider__input::-ms-track:focus{outline:0}input[type=range]{-webkit-appearance:none}input[type=range]::-moz-focus-outer{border:0}.zoom__slider__input::-webkit-slider-thumb{-webkit-appearance:none;box-sizing:border-box;border-radius:999px;background:var(--blue);box-shadow:none;border:3px solid #fff;width:18px;height:18px;position:relative;z-index:1}.zoom__slider__input::-moz-range-thumb{-moz-appearance:none;box-sizing:border-box;border-radius:999px;background:var(--blue);box-shadow:none;border:3px solid #fff;width:18px;height:18px;position:relative;z-index:1}.zoom__slider__input::-ms-thumb{box-sizing:border-box;border-radius:999px;background:var(--blue);box-shadow:none;border:3px solid #fff;width:18px;height:18px;position:relative;z-index:1}input[type=range]{-webkit-appearance:none}input[type=range]::-moz-focus-outer{border:0}.zoom__slider__input::-webkit-slider-thumb::before{-webkit-appearance:none;content:'';display:block;height:4px;width:10000px;position:absolute;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);right:15px;background:var(--blue);pointer-events:none;z-index:-1}.zoom__slider__input::-moz-range-thumb::before{-moz-appearance:none;content:'';display:block;height:4px;width:10000px;position:absolute;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);right:15px;background:var(--blue);pointer-events:none;z-index:-1}.zoom__slider__input::-ms-thumb::before{content:'';display:block;height:4px;width:10000px;position:absolute;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);right:15px;background:var(--blue);pointer-events:none;z-index:-1}input[type=range]{-webkit-appearance:none}input[type=range]::-moz-focus-outer{border:0}.zoom__slider__input::-moz-range-progress{background:var(--blue);box-shadow:1.5px .5px var(--blue),1.5px -.5px var(--blue)}.zoom__slider__input::-ms-fill-lower{background:var(--blue)}:host(.img--dark) .toolbox,:host(.img--dark) .zoom{background:var(--med-black);color:var(--bright-white)}:host(.img--dark) .toolbax__title,:host(.img--dark) .toolbox__tool:hover{color:#fff}:host(.img--dark) .zoom__slider__input::-webkit-slider-runnable-track{-webkit-appearance:none;background:var(--med-black)}:host(.img--dark) .zoom__slider__input::-moz-range-track{-moz-appearance:none;background:var(--med-black)}:host(.img--dark) .zoom__slider__input::-ms-track{background:var(--med-black)}input[type=range]{-webkit-appearance:none}input[type=range]::-moz-focus-outer{border:0}</style><div class="toolbox" id="controls-top"> <input type="text" id="title" class="toolbox__title" placeholder="Enter image title" value="{{title::input}}"> <sm-ui-button id="titleButton" class="toolbox__tool" on-click="toggleTitle" icon="simpla:title"></sm-ui-button> <sm-ui-button class="toolbox__tool" icon="simpla:camera" on-tap="openFilePicker"> <input id="file" class="toolbox__file" type="file" on-change="_filesChanged"> </sm-ui-button> </div> <div class="zoom" id="controls-bottom"> <div class="zoom__slider"> <input id="zoom" type="range" class="zoom__slider__input" min="1" value="{{zoom::input}}" on-change="_updateZoom" max="2" step="0.01"> </div> </div> </template> <script>!function(){"use strict";var t={};t.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,o,i){return o&&t(e.prototype,o),i&&t(e,i),e}}();var e=simpla.constants.easings,o={open:{easing:e.easeOutBack,fill:"both",duration:180,delay:15},close:{easing:e.easeOutCubic,fill:"both",duration:125}},i={observers:["_toggleControls(active)"],_toggleControls:function(t){t?(this._setPosition(),this._openControls()):this._closeControls()},get _controlAnimations(){var t=this.$["controls-top"],e=this.$["controls-bottom"];return[{target:t,begin:{transform:"translateY(-100%)",opacity:.5},end:{transform:"translateY(0)",opacity:1}},{target:e,begin:{transform:"translateY(100%)",opacity:.5},end:{transform:"translateY(0)",opacity:1}}]},_openControls:function(){var t=this;this._controlAnimations.forEach(function(e){var i=e.target,n=e.begin,a=e.end;t.toggleAttribute("visible",!0,i),i.animate([n,a],o.open)})},_closeControls:function(){var t=this;this._controlAnimations.forEach(function(e){var i=e.target,n=e.begin,a=e.end,r=i.animate([a,n],o.close);r.onfinish=function(){t.toggleAttribute("visible",!1,i)}})}},n="toolbox__title--expanded",a=function(){function e(){t.classCallCheck(this,e)}return t.createClass(e,[{key:"beforeRegister",value:function(){this.is="sm-img-controls",this.properties={position:{type:String,reflectToAttribute:!0,value:"right"},title:{type:String,notify:!0},file:{type:Object,readonly:!0,notify:!0},zoom:{type:Number,notify:!0}}}},{key:"toggleTitle",value:function(){var t=this.$.title,e=this.$.titleButton,o=!!t.className.match("\\b"+n+"\\b");e.active=!o,this.toggleClass(n,!o,t)}},{key:"openFilePicker",value:function(t){t&&t.stopPropagation(),this.$.file.click()}},{key:"_setPosition",value:function(){var t=void 0,e=void 0,o=void 0;t={x:window.outerWidth/2,y:window.outerHeight/2},e=this.getBoundingClientRect(),o={x:e.left+e.width/2,y:e.top+e.height/2},this.position=o.x<t.x?"right":"left"}},{key:"_filesChanged",value:function(t){var e=t.target.files;e&&e[0]&&(this.file=e[0])}},{key:"_updateZoom",value:function(){this.zoom=this.$.zoom.value}},{key:"behaviors",get:function(){return[i,simpla.behaviors.active()]}}]),e}();Polymer(a)}();</script></dom-module></div><dom-module id="simpla-img"> <template> <style include="sm-css"></style><style>:root{--placeholder-background:var(--gray);--placeholder-settings:{background-size:cover;background-position:center center;background-repeat:no-repeat};}:host{@apply(--typography);position:relative;display:inline-block;height:auto;width:auto;overflow:hidden}:host([saving]){pointer-events:none}.editor{width:inherit;height:inherit;overflow:hidden}:host([popped]) .editor{box-shadow:0 2px 2px var(--light-black);z-index:var(--on-top)}.placeholder{width:300px;height:300px;min-width:100%;min-height:100%;max-width:100%;max-height:100%;cursor:pointer;background:var(--placeholder-background);@apply(--placeholder-settings)}.placeholder::before{content:'Upload an image';position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:150px;height:50px;text-align:center;font-size:21px;line-height:1.3;font-weight:900;color:var(--med-white);cursor:pointer;z-index:1}</style><sm-utility-placeholder id="placeholder" class="placeholder" show="[[usePlaceholder]]" on-tap="chooseFile"></sm-utility-placeholder> <div class="editor" id="editor"> <sm-img-canvas id="image" src="[[src]]" width="[[width]]" height="[[height]]" scale="[[scale]]" editable="[[editable]]" active="[[active]]" on-pan-finished="updatePosition"> </sm-img-canvas> <sm-img-controls id="controls" zoom="{{scale}}" title="{{title}}" active="[[active]]" on-file-changed="_fileChanged"> </sm-img-controls> </div> <sm-utility-connect id="api" key="[[uid]]" saving="{{saving}}" loading="{{loading}}"> </sm-utility-connect> <sm-utility-share type="state" key="editable" value="{{editable}}"> </sm-utility-share> </template> <script>!function(){"use strict";function e(e){switch(e){case"":case"inherit":case"transparent":return!1;default:return l(e)}}var t={};t.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t.createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var i=void 0,n=void 0;i=simpla.behaviors.persists("api"),n={listeners:{"api.loaded":"_updateFromLoad"},observers:["_uidChanged(uid)","_savingChanged(saving)"],get _uploadingAnimation(){var e=.3,t=.7,i=1.5,n=875,o=void 0,s=void 0,a=void 0;return o=parseFloat(window.getComputedStyle(this).opacity),s=o>e?o*t:o*i,a=this.animate([{opacity:o},{opacity:s}],{easing:"ease-in-out",duration:n,direction:"alternate",iterations:2}),a.finish(),a},_toObject:function(){var e=this.src,t=this.position,i=this.title,n=this.scale,o=t.x,s=t.y;return{src:e,position:{x:o,y:s},title:i,scale:n}},_fromObject:function(e){if(e&&0!==Object.keys(e).length){var t=this._canvas.editable;this._canvas.editable=!0,this.src=e.src,this.position=e.position?{x:e.position.x,y:e.position.y}:{x:0,y:0},this.title=e.title,this.scale=e.scale||1,this._canvas.editable=t}else this.useDefault=!0},_equal:function(e,t){return!(!e||!t)&&e.src===t.src&&e.position&&t.position&&e.position.x===t.position.x&&e.position.y===t.position.y&&e.title===t.title&&e.scale===t.scale},_updateFromLoad:function(e){var t=e.detail;this._fromObject(t.value)},_uidChanged:function(){this.load()},_savingChanged:function(e){var t=this,i=this._uploadingAnimation;e&&(this.active=!1,i.play(),i.onfinish=function(){t.saving&&i.play()})}};var o=[i,n],s=void 0,a=void 0;s=simpla.behaviors["default"](),a={properties:{useDefault:{type:Boolean,observer:"_useDefaultChanged",value:!1}},observers:["_updateDefault(useDefault, _default)"],_updateDefault:function(e,t){e&&(this.src=this._default)},_useDefaultChanged:function(e){e&&this._default&&(this.src=this._default)},_setDefaultAttribute:function(e){this._default=e},_setDefaultElement:function(e){var t=Polymer.dom(e).querySelector("img");this._default=t.src}};var r=[s,a],l=function(e){var t="rgb(0, 0, 0)",i="rgb(255, 255, 255)",n=document.createElement("img"),o=function(t){return n.style.color=t,n.style.color=e,n.style.color!==t};return o(t)&&o(i)},c="--placeholder-background",h=void 0,u=void 0;h=simpla.behaviors.placeholder({observer:"_placeholderChanged",value:"rgb(200,200,200)"},{observer:"_usePlaceholderChanged"}),u={observers:["_setPlaceholderFromEditable(editable)","_setPlaceholderFromSrc(src)"],_setPlaceholderFromEditable:function(e){this.usePlaceholder=e&&(!this.src||""===this.src)},_setPlaceholderFromSrc:function(e){this.usePlaceholder=this.editable&&(!e||""===e)},_usePlaceholderChanged:function(e){this._canvas.style.display=e?"none":""},_placeholderChanged:function(t){this.customStyle[c]=e(t)?t:"url("+t+")",this.updateStyles()}};var d=[h,u],p={easing:simpla.constants.easings.easeOutCubic,fill:"both",duration:150},v=1.02,f=12,g=15,y={properties:{popout:{type:Boolean,reflectToAttribute:!0,value:!1},popped:{type:Boolean,value:!1,reflectToAttribute:!0},_prePopped:{type:Object,value:{inlineWidth:"",inlineHeight:""}}},observers:["_togglePopped(active, popout, popped)"],ready:function(){var e=this;window.addEventListener("scroll",function(){e.popped&&(e.active=e.popped=!1)})},_togglePopped:function(e,t,i){!e||!t&&this._inViewport()?i&&this._popBack():this._popOut()},get _poppedFrames(){var e=this.getBoundingClientRect(),t={top:e.top,left:e.left};return e.right>window.innerWidth?t.left=window.innerWidth-e.width-f:e.left<f&&(t.left=f),e.bottom>window.innerHeight?t.top=window.innerHeight-e.height-f:e.top<f&&(t.top=f),[{top:e.top+"px",left:e.left+"px",transform:"scale(1)"},{top:t.top+"px",left:t.left+"px",transform:"scale("+v+")"}]},_popOut:function(){var e=this._poppedFrames,t=this.getBoundingClientRect(),i=this.$.editor;this.popped=!0,this._prePopped.inlineWidth=this.style.width,this._prePopped.inlineHeight=this.style.height,this.style.width=t.width+"px",this.style.height=t.height+"px",i.style.position="fixed",i.animate(e,p)},_popBack:function(){var e=this,t=this._prePopped,i=t.inlineWidth,n=t.inlineHeight,o=this._poppedFrames,s=this.$.editor,a=void 0;a=s.animate(o.reverse(),p),a.onfinish=function(){e.style.width=i,e.style.height=n,s.style.position="",e.popped=!1}},_inViewport:function(){var e=this.getBoundingClientRect(),t=e.top>=-g,i=e.left>=-g,n=e.bottom<=window.innerHeight+g,o=e.right<=window.innerWidth+g;return t&&i&&n&&o}},_=function(){function e(){t.classCallCheck(this,e)}return t.createClass(e,[{key:"beforeRegister",value:function(){this.is="simpla-img",this.properties={src:{type:String,value:""},width:Number,height:Number,scale:{type:Number,value:1},position:{type:Object,value:{x:0,y:0},observer:"_positionChanged"}}}},{key:"_positionChanged",value:function(e){this._canvas.translateX=e.x,this._canvas.translateY=e.y}},{key:"ready",value:function(){var e=this;this._syncImgSizing(),window.addEventListener("resize",function(){e.debounce("syncImgSizing",e._syncImgSizing.bind(e))})}},{key:"updatePosition",value:function(){var e=this._canvas;this.position={x:e.translateX,y:e.translateY}}},{key:"chooseFile",value:function(e){e&&e.stopPropagation(),this._controls.openFilePicker()}},{key:"_fileChanged",value:function(e){var t=this,i=new FileReader,n=e.detail.value;i.onloadend=function(){t.src=i.result,t.active=!0},i.readAsDataURL(n)}},{key:"_activeChanged",value:function(e){var t=this,i=function(e){e.__polymerGesturesHandled||(t.active=!1)};this.active?window.removeEventListener("click",i,!1):window.addEventListener("click",i,!1)}},{key:"_handleTap",value:function(e){var t=e.target;this.editable&&"file"!==t.type&&(t===this._placeholder?this._controls.openFilePicker():this.active=!0)}},{key:"_syncImgSizing",value:function(){var e=this,t=this.$.image,i=function(t){var i=e.style.display,n=void 0,o=void 0;return e.style.display="none",n=window.getComputedStyle(e),o=n[t],e.style.display=i,o.match(/%/)};t.style.width=i("width")?"100%":"inherit",t.style.height=i("height")?"100%":"inherit"}},{key:"behaviors",get:function(){return[].concat(simpla.behaviors.editable(),simpla.behaviors.active({observer:"_activeChanged"}),y,d,r,o)}},{key:"listeners",get:function(){return{tap:"_handleTap"}}},{key:"_canvas",get:function(){return this.$.image}},{key:"_controls",get:function(){return this.$.controls}},{key:"_placeholder",get:function(){return this.$.placeholder}}]),e}();Polymer(_)}();</script></dom-module></body></html>