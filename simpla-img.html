<link rel="import" href="../polymer/polymer.html"> <dom-module id="simpla-img"> <script>!function(){"use strict";function e(e,t){c[t.uid]={src:e.src,zoom:e.zoom,position:e.position}}function t(e,t){c[t.uid]&&l(e,c[t.uid])}function i(e,t){if(!f){var i=t.resolveUrl(u),n=document.createElement("link");n.rel="import",n.setAttribute("async",!0),n.href=i,document.head.appendChild(n),document.body.appendChild(e),f=!0}}function n(e,t){var i=t.getBoundingClientRect(),n=i.top,r=i.left,o=i.width,a=i.height,s=window,d=s.scrollX,c=s.scrollY;n+=c,r+=d,l(e,{top:n,left:r,width:o,height:a})}function r(e,t){var i=t.src,n=t.alt;l(e,{src:i,alt:n})}function o(e,t){var i,r=function i(){p&&(t.editing=!0),e.removeEventListener("image-loaded",i)};p=null,i={},s(i,"output-changed",function(e){t.src=e.detail.value}),s(i,"alt-changed",function(e){t.alt=e.detail.value}),s(i,"active-changed",function(e){e.detail.value||(t.editing=!1)}),s(i,"src-changed",function(i){var r=void 0,o=void 0;o=function(){n(e,t),t.src=r,t.removeEventListener("load",o)},r=t.src,t.addEventListener("load",o),t.src=i.detail.value}),s(i,"keyup",function(e){var i=13===e.keyCode&&e.metaKey,n=27===e.keyCode;(i||n)&&(t.editing=!1)}),s(i,"blur",function(t){e.active=!1}),s(i,"opening-filepicker",function(i){p=t,e.addEventListener("image-loaded",r)}),v=i,Object.keys(v).forEach(function(t){e.addEventListener(t,v[t])})}function a(e){Object.keys(v).forEach(function(t){e.removeEventListener(t,v[t])})}var s=function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},d={properties:{uid:{type:String,observer:"_initUid"},_simplaObservers:{type:Object,value:function(){return{}}}},observers:["_setData(src, alt, uid)"],created:function(){window.Simpla||console.error("Cannot find Simpla global")},attached:function(){this.editable=this.editable||Simpla.getState("editable"),this._observeEditable()},detached:function(){var e=this;Object.keys(this._simplaObservers).forEach(function(t){e._simplaObservers[t].unobserve()}),this._simplaObservers=[]},_initUid:function(e){var t=this;Simpla.get(e).then(function(e){return t._setPropsFromSimpla(e)}),this._observeBuffer(e)},_setData:function(e,t,i){return Simpla.set(i,{type:"Image",data:{src:e,alt:t}})},_observeBuffer:function(e){var t=this,i=this._simplaObservers;e&&(i.buffer&&i.buffer.unobserve(),i.buffer=Simpla.observe(e,function(e){return t._setPropsFromSimpla(e)}))},_setPropsFromSimpla:function(e){e&&e.data&&l(this,e.data)},_observeEditable:function(){var e=this,t=this._simplaObservers;t.editable&&t.editable.unobserve(),t.editable=Simpla.observeState("editable",function(t){return e.editable=t})}},c={},u="simpla-img-editor.html",f=!1,v=void 0,p=void 0,b=document.createElement("simpla-img-editor"),h=void 0,g={observers:["_stopEditingOnResizeOrScroll(editing, popped)","_toggleEditorBindings(editing)","_ensureEditorReady(editable)"],listeners:{tap:"_tapHandler"},_tapHandler:function(){this.editable&&(this.editing=!0)},_toggleEditorBindings:function(i){if(i)h&&(h.editing=!1),o(b,this),n(b,this),r(b,this),t(b,this),h=this,b.active=!0;else{if(!h)return;b.active=!1,a(b,h),e(b,h),b.clear(),h=null}},_ensureEditorReady:function(e){e&&i(b,this)},_stopEditingOnResizeOrScroll:function(e){var t=this,i=this.__exitHandler=this.__exitHandler||function(){return t.editing=!1};e&&popped?(window.addEventListener("resize",i),this.async(function(){return window.addEventListener("scroll",i)},100)):(window.removeEventListener("resize",i),window.removeEventListener("scroll",i))}},m={editable:{cursor:"pointer"},editing:{visibility:"hidden",transition:"visibility",transitionDelay:"50ms"},placeholder:{background:"#b2bcc8",width:"180px",height:"130px"}},y={is:"simpla-img",extends:"img",properties:{src:{type:String,reflectToAttribute:!0,value:"",notify:!0},alt:{type:String,reflectToAttribute:!0,value:"",notify:!0},editable:{type:Boolean,notify:!0,value:!1},editing:{type:Boolean,notify:!0,value:!1}},observers:["_styleEditable(editable)","_styleEditing(editing)","_showPlaceholder(editable, editing, src)"],behaviors:[d,g],_styleEditable:function(e){this._toggleStyles(m.editable,e)},_styleEditing:function(e){this._toggleStyles(m.editing,e)},_showPlaceholder:function(e,t,i){var n=e&&!t&&!i;this._toggleStyles(m.placeholder,n)},_toggleStyles:function(e,t){var i=this;Object.keys(e).forEach(function(n){i.style[n]=t?e[n]:""})}};Polymer(y)}()</script> </dom-module> 