<link rel="import" href="../polymer/polymer.html"> <link rel="import" href="../simpla-styles/simpla-styles.html"> <link rel="import" href="../iron-iconset-svg/iron-iconset-svg.html"> <link rel="import" href="../iron-icon/iron-icon.html" async> <link rel="import" href="../paper-slider/paper-slider.html" async> <link rel="import" href="./simpla-img-cropper.html"> <iron-iconset-svg name="simpla-img"> <svg> <defs> <g id="camera-alt"><circle cx="12" cy="12" r="3.2"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></g> <g id="title"><path d="M5 4v3h5.5v12h3V7H19V4z"/></g> </defs> </svg> </iron-iconset-svg> <dom-module id="simpla-img-editor"> <template> <style>*,::after,::before,:host{box-sizing:border-box}:host{display:block;position:absolute;outline:0;-webkit-transition:box-shadow 130ms var(--simpla-easing-standard),-webkit-transform .2s var(--simpla-easing-standard);transition:box-shadow 130ms var(--simpla-easing-standard),-webkit-transform .2s var(--simpla-easing-standard);transition:box-shadow 130ms var(--simpla-easing-standard),transform .2s var(--simpla-easing-standard);transition:box-shadow 130ms var(--simpla-easing-standard),transform .2s var(--simpla-easing-standard),-webkit-transform .2s var(--simpla-easing-standard);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-smoothing:antialiased}:host([hidden])){display:none}:host([visible]){box-shadow:var(--simpla-elevation-1)}.editor{position:relative;width:100%;height:100%;overflow:hidden}.cropper-view-box{outline:0}.cropper-face{opacity:0}.cropper-line,.cropper-point{display:none}.tools,.zoom{position:absolute;background:var(--simpla-bright-white);z-index:1;height:30px;-webkit-transition:-webkit-transform 130ms var(--simpla-easing-decelerate);transition:-webkit-transform 130ms var(--simpla-easing-decelerate);transition:transform 130ms var(--simpla-easing-decelerate);transition:transform 130ms var(--simpla-easing-decelerate),-webkit-transform 130ms var(--simpla-easing-decelerate)}.tools{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;top:0;right:7px;border-bottom-left-radius:var(--simpla-border-radius);border-bottom-right-radius:var(--simpla-border-radius);color:var(--simpla-grey-700)}.zoom{bottom:0;width:85%;left:0;right:0;margin:auto;border-top-left-radius:var(--simpla-border-radius);border-top-right-radius:var(--simpla-border-radius)}:host(:not([visible])) .tools,:host(:not([visible])) .zoom{-webkit-transition-duration:60ms;transition-duration:60ms;-webkit-transition-timing-function:var(--simpla-easing-accelerate);transition-timing-function:var(--simpla-easing-accelerate)}:host(:not([visible])) .zoom{-webkit-transform:translateY(100%);transform:translateY(100%)}:host(:not([visible])) .tools{-webkit-transform:translateY(-100%);transform:translateY(-100%)}.zoom__slider{width:100%;height:100%;cursor:pointer;--paper-slider-active-color:var(--simpla-primary-color);--paper-slider-knob-color:var(--simpla-primary-color);--paper-slider-container-color:var(--simpla-grey-500);--paper-slider-knob-start-border-color:var(--simpla-grey-700)}.tools__tool{display:inline-block;padding:5px 10px 7px;cursor:pointer}.tools__tool:hover,.tools__tool[data-active]{color:var(--simpla-primary-color)}.tools__tool__icon{--iron-icon-width:15px;--iron-icon-height:15px}.title-input{background:0 0;border:none;width:0;padding:0;outline:0;-webkit-transition:width 150ms var(--simpla-easing-standard);transition:width 150ms var(--simpla-easing-standard)}.title-input::-webkit-input-placeholder{color:var(--simpla-grey-700)}.title-input::-moz-placeholder{color:var(--simpla-grey-700)}.title-input:-ms-input-placeholder{color:var(--simpla-grey-700)}.title-input::placeholder{color:var(--simpla-grey-700)}.title-input[data-expanded]{width:80px;padding-left:1em}[hidden]{display:none!important}</style> <div class="editor"> <div class="tools" on-transitionend="_hideIfInactive"> <input type="text" id="title-input" class="title-input" placeholder="Enter a title" value="{{alt::input}}" data-expanded$="[[_titleOpen]]" on-blur="_toggleTitle"> <a class="tools__tool" on-tap="_toggleTitle" data-active$="[[_titleOpen]]"> <iron-icon class="tools__tool__icon" icon="simpla-img:title"> </iron-icon> </a> <a class="tools__tool" on-tap="openFilePicker"> <iron-icon class="tools__tool__icon" icon="simpla-img:camera-alt"> </iron-icon> <input type="file" id="file-input" on-change="_uploadImg" hidden> </a> </div> <simpla-img-cropper src="[[src]]" width="[[width]]" height="[[height]]" scale="[[zoom]]" active="[[active]]" output="{{output}}"> </simpla-img-cropper> <div class="zoom" on-transitionend="_hideIfInactive"> <paper-slider id="slider" class="zoom__slider" immediate-value="{{zoom}}" value="[[zoom]]" step="0.01" min="1" max="3" no-ink=""> </paper-slider> </div> </div> </template> <script>!function(){"use strict";function t(t,e,i){var n=t.width,o=t.height,r=void 0;return r=Math.min(1,Math.min(e.width/n,e.height/o)),(r*n<i.width||r*o<i.height)&&(r=Math.max(i.width/n,i.height/o)),{width:Math.round(n*r),height:Math.round(o*r)}}function e(t,e,i){var n=t.top,o=t.left,r=t.width,l=t.height,a=o+r,s=n+l,h=0,u=0,v=void 0;return v={left:e.scrollX+i,top:e.scrollY+i,right:e.scrollX+e.innerWidth-i,bottom:e.scrollY+e.innerHeight-i},o<v.left?h=v.left-o:a>v.right&&(h=v.right-a),n<v.top?u=v.top-n:s>v.bottom&&(u=v.bottom-s),{translateY:u,translateX:h}}function i(i,r){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o,s=void 0,h=void 0,u=void 0,v=void 0,f=void 0;s={width:r.innerWidth-2*l,height:r.innerHeight-2*l};var c=t(i,s,a);h=c.width,u=c.height;var d=e({top:i.top,left:i.left,width:h,height:u},r,l);return v=d.translateX,f=d.translateY,{width:h,height:u,translateX:v,translateY:f}}var n=8,o={width:180,height:130},r={observers:["_fitIntoVisibleWindow(top, left, width, height, visible)"],_fitIntoVisibleWindow:function(t,e,n,o,r){var l=this;r||(this.style.transform=""),this.debounce("fit-to-window",function(){var r={top:t,left:e,width:n,height:o},a=void 0,s=void 0,h=i(r,window);n=h.width,o=h.height,a=h.translateX,s=h.translateY,l.width=n,l.height=o,l.style.transform="translate("+a+"px, "+s+"px)"})}},l=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},h=function(){function t(){l(this,t)}return a(t,[{key:"beforeRegister",value:function(){this.is="simpla-img-editor",this.properties={active:{type:Boolean,value:!1,notify:!0},visible:{type:Boolean,reflectToAttribute:!0,readonly:!0,value:!1},hidden:{type:Boolean,reflectToAttribute:!0,readonly:!0,value:!0},src:{type:String,notify:!0},alt:{type:String,notify:!0,value:""},zoom:{type:Number,notify:!0,value:1},width:{type:Number,observer:"_observeWidth"},height:{type:Number,observer:"_observeHeight"},top:{type:Number,observer:"_observeTop",value:0},left:{type:Number,observer:"_observeLeft",value:0},output:{type:String,notify:!0,readOnly:!0},_titleOpen:{type:Boolean,value:!1},tabindex:{type:Number,reflectToAttribute:!0,value:0}},this.observers=["_toggleVisibility(active)","_focusOnActive(active)"]}},{key:"clear",value:function(){s(this,{src:"",alt:"",zoom:1})}},{key:"openFilePicker",value:function(t){t&&t.stopPropagation(),this.fire("opening-filepicker"),this.$["file-input"].click()}},{key:"_observeWidth",value:function(t){this.style.width=t+"px"}},{key:"_observeHeight",value:function(t){this.style.height=t+"px"}},{key:"_observeLeft",value:function(t){this.style.left=t+"px"}},{key:"_observeTop",value:function(t){this.style.top=t+"px"}},{key:"_toggleVisibility",value:function(t){var e=this;t?(this.hidden=!1,Polymer.RenderStatus.afterNextRender(this,function(){return e.visible=!0})):this.visible=!1}},{key:"_hideIfInactive",value:function(t){this.active||(this.hidden=!0,this.visible=!1)}},{key:"_uploadImg",value:function(t){var e=this,i=t.target.files,n=new FileReader,o=function t(i){e.src=i.target.result,n.removeEventListener("load",t)};this.fire("image-loaded"),this.focus(),i&&i[0]&&(n.addEventListener("load",o),n.readAsDataURL(i[0]))}},{key:"focus",value:function(){var t=window,e=t.scrollY,i=t.scrollX;HTMLElement.prototype.focus.call(this),window.scrollTo(i,e)}},{key:"_toggleTitle",value:function(){this._titleOpen=!this._titleOpen}},{key:"_focusOnActive",value:function(t){var e=this;t&&this.async(function(){return e.focus()},0)}},{key:"behaviors",get:function(){return[r]}}]),t}();Polymer(h)}()</script> </dom-module> 