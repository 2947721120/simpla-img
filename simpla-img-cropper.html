<link rel="import" href="../polymer/polymer.html"> <dom-module id="simpla-img-cropper"> <template> <style>:host{position:relative;display:inline-block;overflow:hidden;width:inherit;height:inherit;vertical-align:bottom;background:-webkit-linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),-webkit-linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),rgba(255,255,255,.02);background:linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),rgba(255,255,255,.02);background-position:0 0,15px 15px;background-size:30px 30px}:host:hover::before{content:'';position:absolute;top:0;right:0;bottom:0;left:0;background:var(--light-white);cursor:pointer;z-index:1}:host([active]){cursor:move}:host([active])::before{display:none}:host([active]) .img{-webkit-user-drag:none}.img{vertical-align:bottom;-webkit-transform-origin:0 0;transform-origin:0 0;width:inherit;height:inherit}</style> <img id="source" class="img" crossorigin="anonymous" src$="[[src]]" width$="[[width]]" height$="[[height]]" on-track="_dragImage" on-tap="_handleImgTap" on-load="_imageLoaded"> </template> <script>!function(){"use strict";function t(t,e){return t<e.min?e.min:t>e.max?e.max:t}function e(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=Math.pow(10,e);return Math.round(t*i)/i}var i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),n=1,a=0,r=0,h=[1,0,0,1,0,0],o="pan-finished",u=document.createElement("canvas"),l=u.getContext("2d"),c=function(){function c(){i(this,c)}return s(c,[{key:"beforeRegister",value:function(){this.is="simpla-img-cropper",this.properties={width:Number,height:Number,src:String,scale:Number,translateX:Number,translateY:Number,active:{type:Boolean,reflectToAttribute:!0,value:!1},output:{type:String,readOnly:!0,notify:!0},_transform:{type:String,value:""},position:{type:Object,value:function(){return{x:0,y:0}},observer:"_positionChanged",notify:!0}},this.observers=["_updateStyles(_transform)","_debouncedRender(_transform)","_updatePosition(_transform)"]}},{key:"attached",value:function(){this.setScrollDirection("all",this.$.source)}},{key:"_paint",value:function(){var t=this;this._tick&&(cancelAnimationFrame(this._tick),this._tick=null),this._tick=requestAnimationFrame(function(){var e=t.scale,i=t.translateX,s=t.translateY;t._transform="scale("+e+") translateX("+i+"px) translateY("+s+"px)"})}},{key:"_resetDimensions",value:function(){this._width=this.offsetWidth,this._height=this.offsetHeight,this._imgWidth=this.$.source.offsetWidth,this._imgHeight=this.$.source.offsetHeight}},{key:"_dragImage",value:function(t){var e=t.detail,i=e.dx,s=e.dy,n=e.ddx,a=e.ddy,r=e.state;"start"===r&&this._resetDimensions(),this.translateX+=("start"===r?i:n)/this.scale,this.translateY+=("start"===r?s:a)/this.scale,"end"===r&&this.fire(o)}},{key:"_imageLoaded",value:function(){this._resetDimensions()}},{key:"_positionChanged",value:function(t){if(t){var e=t.x,i=t.y;this.translateX=e,this.translateY=i}}},{key:"_updatePosition",value:function(){this.position={x:this.translateX,y:this.translateY}}},{key:"_updateStyles",value:function(t){this.$.source.style.transform=t}},{key:"_debouncedRender",value:function(){this.debounce("render",this._render)}},{key:"_render",value:function(){var t=this.width,e=this.height,i=this.scale,s=this.translateX,n=this.translateY,a=this.$.source,r=a.naturalWidth,o=a.naturalHeight,c=t/r,f=e/o;u.width=r,u.height=o,l.setTransform.apply(l,h),l.scale(i,i),l.translate(s/c,n/f),l.drawImage(this.$.source,0,0),this._setOutput(u.toDataURL())}},{key:"scale",get:function(){return this._scale||n},set:function(t){var i=this.minScale;t<i?this._scale=e(parseFloat(i),2):this._scale=e(parseFloat(t),2),this.translateX+=0,this.translateY+=0,this._paint()}},{key:"translateX",get:function(){return this._translateX||a},set:function(i){this._translateX=e(t(i,this._bounds.x)),this._paint()}},{key:"translateY",get:function(){return this._translateY||r},set:function(i){this._translateY=e(t(i,this._bounds.y)),this._paint()}},{key:"minScale",get:function(){var t=this.height/this.$.source.height,e=this.width/this.$.source.width;return isNaN(t)||isNaN(e)?1:t<e?t:e}},{key:"_bounds",get:function(){return this._imgWidth&&this._width&&this._imgHeight&&this._height?{x:{min:-(this._imgWidth*this.scale-this._width)/this.scale,max:0},y:{min:-(this._imgHeight*this.scale-this._height)/this.scale,max:0}}:{x:{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY},y:{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY}}}}]),c}();Polymer(c)}()</script> </dom-module> 