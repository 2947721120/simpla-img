<link rel="import" href="../polymer/polymer.html"> <dom-module id="simpla-img-cropper"> <template> <style>:host{position:relative;display:inline-block;overflow:hidden;width:inherit;height:inherit;vertical-align:bottom;background:-webkit-linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),-webkit-linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),rgba(255,255,255,.02);background:linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),rgba(255,255,255,.02);background-position:0 0,15px 15px;background-size:30px 30px}:host:hover::before{content:'';position:absolute;top:0;right:0;bottom:0;left:0;background:var(--light-white);cursor:pointer;z-index:1}:host([active]){cursor:move}:host([active])::before{display:none}:host([active]) .img{-webkit-user-drag:none}.img{vertical-align:bottom;-webkit-transform-origin:0 0;transform-origin:0 0;width:inherit;height:inherit}</style> <img id="source" class="img" crossorigin="anonymous" src$="[[src]]" width$="[[width]]" height$="[[height]]" on-track="_dragImage" on-tap="_handleImgTap" on-load="_imageLoaded"> </template> <script>!function(){"use strict";function t(t,e){return t<e.min?e.min:t>e.max?e.max:t}var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),s=1,n=0,a=0,r=[1,0,0,1,0,0],h="pan-finished",u=document.createElement("canvas"),o=u.getContext("2d"),c=function(){function c(){e(this,c)}return i(c,[{key:"beforeRegister",value:function(){this.is="simpla-img-cropper",this.properties={width:Number,height:Number,src:String,scale:Number,translateX:Number,translateY:Number,active:{type:Boolean,reflectToAttribute:!0,value:!1},output:{type:String,readOnly:!0,notify:!0},_transform:{type:String,value:""}},this.observers=["_updateStyles(_transform)","_debouncedRender(_transform)"]}},{key:"attached",value:function(){this.setScrollDirection("all",this.$.source)}},{key:"_updateStyles",value:function(t){this.$.source.style.transform=t}},{key:"_debouncedRender",value:function(){var t=this.width,e=this.height,i=this.scale,s=this.translateX,n=this.translateY;u.width=t,u.height=e,o.setTransform.apply(o,r),o.drawImage(this.$.source,s,n,t*i,e*i),this._setOutput(u.toDataURL())}},{key:"_paint",value:function(){var t=this;this._tick&&(cancelAnimationFrame(this._tick),this._tick=null),this._tick=requestAnimationFrame(function(){var e=t.scale,i=t.translateX,s=t.translateY;t._transform="scale("+e+") translateX("+i+"px) translateY("+s+"px)"})}},{key:"_resetDimensions",value:function(){this._width=this.offsetWidth,this._height=this.offsetHeight,this._imgWidth=this.$.source.offsetWidth,this._imgHeight=this.$.source.offsetHeight}},{key:"_dragImage",value:function(t){var e=t.detail,i=e.dx,s=e.dy,n=e.ddx,a=e.ddy,r=e.state;"start"===r&&this._resetDimensions(),this.translateX+=("start"===r?i:n)/this.scale,this.translateY+=("start"===r?s:a)/this.scale,"end"===r&&this.fire(h)}},{key:"_imageLoaded",value:function(){this._resetDimensions()}},{key:"scale",get:function(){return this._scale||s},set:function(t){var e=this.minScale;t<e?this._scale=parseFloat(e):this._scale=parseFloat(t),this.translateX+=0,this.translateY+=0,this._paint()}},{key:"translateX",get:function(){return this._translateX||n},set:function(e){this._translateX=t(e,this._bounds.x),this._paint()}},{key:"translateY",get:function(){return this._translateY||a},set:function(e){this._translateY=t(e,this._bounds.y),this._paint()}},{key:"minScale",get:function(){var t=this.height/this.$.source.height,e=this.width/this.$.source.width;return isNaN(t)||isNaN(e)?1:t<e?t:e}},{key:"_bounds",get:function(){return this._imgWidth&&this._width&&this._imgHeight&&this._height?{x:{min:-(this._imgWidth*this.scale-this._width)/this.scale,max:0},y:{min:-(this._imgHeight*this.scale-this._height)/this.scale,max:0}}:{x:{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY},y:{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY}}}}]),c}();Polymer(c)}()</script> </dom-module> 