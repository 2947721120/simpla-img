<link rel="import" href="../polymer/polymer.html"> <link rel="import" href="../sm-ui-core/sm-ui-core.html"> <dom-module id="sm-img-canvas"> <template> <style include="sm-css"></style> <style>:host{position:relative;display:inline-block;overflow:hidden;width:inherit;height:inherit;vertical-align:bottom}:host([editable]){background:-webkit-linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),-webkit-linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),rgba(255,255,255,.02);background:linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),rgba(255,255,255,.02);background-position:0 0,15px 15px;background-size:30px 30px}:host([editable]:hover)::before{content:'';position:absolute;top:0;right:0;bottom:0;left:0;background:var(--light-white);cursor:pointer;z-index:1}:host([active]){cursor:move}:host([active])::before{display:none}.img{vertical-align:bottom;-webkit-transform-origin:0 0;transform-origin:0 0;width:inherit;height:inherit}</style> <img id="source" class="img" src$="[[src]]" width$="[[width]]" height$="[[height]]" on-track="_dragImage" on-tap="_handleImgTap" on-load="_imageLoaded"> </template> <script>!function(){"use strict";function t(t,e){return t<e.min?e.min:t>e.max?e.max:t}function e(t){var e=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],i=["webkit","moz","o","ms"];return e&&(i=i.map(function(t){return"-"+t+"-"})),i.map(function(e){return""+e+t})}var i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=1,a=0,r=0,h="pan-finished",o=function(){function o(){i(this,o)}return n(o,[{key:"beforeRegister",value:function(){this.is="sm-img-canvas",this.properties={width:Number,height:Number,src:String,scale:Number,translateX:Number,translateY:Number,editable:{type:Boolean,reflectToAttribute:!0,value:!1},active:{type:Boolean,reflectToAttribute:!0,observer:"_activeChanged",notify:!0,value:!1}}}},{key:"_paint",value:function(){var t=this;this._tick&&(cancelAnimationFrame(this._tick),this._tick=null),this._tick=requestAnimationFrame(function(){var i=t.scale,n=t.translateX,s=t.translateY,a="scale("+i+") translateX("+n+"px) translateY("+s+"px)";e("Transform").concat("transform").forEach(function(e){t.$.source.style[e]=a})})}},{key:"_resetDimensions",value:function(){this._width=this.offsetWidth,this._height=this.offsetHeight,this._imgWidth=this.$.source.offsetWidth,this._imgHeight=this.$.source.offsetHeight}},{key:"_dragImage",value:function(t){var e=t.detail,i=e.dx,n=e.dy,s=e.ddx,a=e.ddy,r=e.state;"start"===r&&this._resetDimensions(),this.translateX+=("start"===r?i:s)/this.scale,this.translateY+=("start"===r?n:a)/this.scale,"end"===r&&this.fire(h)}},{key:"_handleImgTap",value:function(t){this.editable&&t.preventDefault()}},{key:"_imageLoaded",value:function(){this._resetDimensions()}},{key:"_activeChanged",value:function(t){var e=t?"none":"all";this.setScrollDirection(e,this.$.source)}},{key:"scale",get:function(){return this._scale||s},set:function(t){if(this.active){var e=this.minScale;t<e?this._scale=parseFloat(e):this._scale=parseFloat(t),this.translateX+=0,this.translateY+=0,this._paint()}}},{key:"translateX",get:function(){return this._translateX||a},set:function(e){this.active&&(this._translateX=t(e,this._bounds.x),this._paint())}},{key:"translateY",get:function(){return this._translateY||r},set:function(e){this.active&&(this._translateY=t(e,this._bounds.y),this._paint())}},{key:"minScale",get:function(){var t=this.height/this.$.source.height,e=this.width/this.$.source.width;return isNaN(t)||isNaN(e)?1:t<e?t:e}},{key:"_bounds",get:function(){return this._imgWidth&&this._width&&this._imgHeight&&this._height?{x:{min:-(this._imgWidth*this.scale-this._width)/this.scale,max:0},y:{min:-(this._imgHeight*this.scale-this._height)/this.scale,max:0}}:{x:{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY},y:{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY}}}}]),o}();Polymer(o)}()</script> </dom-module>