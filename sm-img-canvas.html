<link rel="import" href="../polymer/polymer.html"> <link rel="import" href="../simpla-core/simpla-core.html"> <dom-module id="sm-img-canvas"> <template> <style include="sm-css"></style><style>:host{position:relative;display:inline-block;overflow:hidden;width:inherit;height:inherit;vertical-align:bottom}:host([editable]){background:-webkit-linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),-webkit-linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),rgba(255,255,255,.02);background:linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),linear-gradient(45deg,rgba(0,0,0,.02) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 75%,rgba(0,0,0,.02) 75%,rgba(0,0,0,.02) 0),rgba(255,255,255,.02);background-position:0 0,15px 15px;background-size:30px 30px}:host([editable]:hover)::before{content:'';position:absolute;top:0;right:0;bottom:0;left:0;background:var(--light-white);cursor:pointer;z-index:1}:host([active]){cursor:move}:host([active])::before{display:none}.img{vertical-align:bottom;-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;width:inherit;height:inherit}</style><img id="source" class="img" src$="[[src]]" width$="[[width]]" height$="[[height]]" on-track="_dragImage" on-down="_stopEvent" on-load="_imageLoaded"> </template> <script>!function(){"use strict";function t(t,e){return t<e.min?e.min:t>e.max?e.max:t}function e(t){var e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],i=["webkit","moz","o","ms"];return e&&(i=i.map(function(t){return"-"+t+"-"})),i.map(function(e){return""+e+t})}var i={};i.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i.createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var s=1,n=0,a=0,r="pan-finished",h=function(){function h(){i.classCallCheck(this,h)}return i.createClass(h,[{key:"beforeRegister",value:function(){this.is="sm-img-canvas",this.properties={width:Number,height:Number,src:String,scale:Number,translateX:Number,translateY:Number}}},{key:"_paint",value:function(){var t=this;this._tick&&(cancelAnimationFrame(this._tick),this._tick=null),this._tick=requestAnimationFrame(function(){var i=t.scale,s=t.translateX,n=t.translateY,a="scale("+i+") translateX("+s+"px) translateY("+n+"px)";e("Transform").concat("transform").forEach(function(e){t.$.source.style[e]=a})})}},{key:"_resetDimensions",value:function(){this._width=this.offsetWidth,this._height=this.offsetHeight,this._imgWidth=this.$.source.offsetWidth,this._imgHeight=this.$.source.offsetHeight}},{key:"_dragImage",value:function(t){var e=t.detail,i=e.dx,s=e.dy,n=e.ddx,a=e.ddy,h=e.state;"start"===h&&this._resetDimensions(),this.translateX+=("start"===h?i:n)/this.scale,this.translateY+=("start"===h?s:a)/this.scale,"end"===h&&this.fire(r)}},{key:"_stopEvent",value:function(t){t.preventDefault()}},{key:"_imageLoaded",value:function(){this._resetDimensions()}},{key:"behaviors",get:function(){return[simpla.behaviors.editable({reflectToAttribute:!0,notify:!1}),simpla.behaviors.active({reflectToAttribute:!0})]}},{key:"scale",get:function(){return this._scale||s},set:function(t){if(this.editable){var e=this.minScale;e>t?this._scale=parseFloat(e):this._scale=parseFloat(t),this.translateX+=0,this.translateY+=0,this._paint()}}},{key:"translateX",get:function(){return this._translateX||n},set:function(e){this.editable&&(this._translateX=t(e,this._bounds.x),this._paint())}},{key:"translateY",get:function(){return this._translateY||a},set:function(e){this.editable&&(this._translateY=t(e,this._bounds.y),this._paint())}},{key:"minScale",get:function(){var t=this.height/this.$.source.height,e=this.width/this.$.source.width;return isNaN(t)||isNaN(e)?1:e>t?t:e}},{key:"_bounds",get:function(){return this._imgWidth&&this._width&&this._imgHeight&&this._height?{x:{min:-(this._imgWidth*this.scale-this._width)/this.scale,max:0},y:{min:-(this._imgHeight*this.scale-this._height)/this.scale,max:0}}:{x:{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY},y:{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY}}}}]),h}();Polymer(h)}();</script></dom-module>